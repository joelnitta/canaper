---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

<!-- You'll still need to render `README.Rmd` regularly, to keep `README.md` up-to-date. `devtools::build_readme()` is handy for this. You could also use GitHub Actions to re-render `README.Rmd` every time you push. An example workflow can be found here: <https://github.com/r-lib/actions/tree/master/examples>. -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# canaper

<!-- badges: start -->
<!-- badges: end -->

The goal of canaper is to enable categorical analysis of neo- and paleo-endemism (CANAPE) in R.

## Installation

You can install canaper from [GitHub](https://github.com/) with:

``` r
# install.packages("remotes")
remotes::install_github("joelnitta/canaper")
```

## Example usage

These examples will use the dataset included with the `picante` package.

```{r example-data}
library(canaper)
library(picante)

data(phylocom)

# Example community matrix including 4 "clumped" communities, 
# one "even" community, and one "random" community
phylocom$sample

# Example phylogeny
phylocom$phy
```

The main "workhorse" function of `canaper` is `cpr_rand_test()`, which conducts a randomization test to determine if observed values of phylogenetic diversity (PD) and phylogenetic endemism (PE) are significantly different from random. It also calculates the same values on an alternative phylogeny where all branch lengths have been set equal (alternative PD, alternative PE) as well as the ratio of the original value to the alternative value (relative PD, relative PE).

```{r rand-test-example}
rand_test_results <- cpr_rand_test(phylocom$sample, phylocom$phy)
```

`cpr_rand_test` produces **a lot** of columns (nine per metric), so let's just look at a subset of them:

```{r rand-test-res}
rand_test_results[,1:9]
```

This is a summary of the columns:

* `*_obs`: Observed value
* `*_obs_c_lower`: Count of times observed value was lower than random values
* `*_obs_c_upper`: Count of times observed value was higher than random values
* `*_obs_p_lower`: Percentage of times observed value was lower than random values
* `*_obs_p_upper`: Percentage of times observed value was higher than random values
* `*_obs_q`: Count of the non-NA random values used for comparison
* `*_obs_z`: Standard effect size (z-score)
* `*_rand_mean`: Mean of the random values
* `*_rand_sd`: Standard deviation of the random values

The next step in CANAPE is to classify endemism types according to the significance of PE, alternative PE, and relative PE. This adds a column called `endem_type`.

```{r categorize-endem}
canape_results <- cpr_classify_endem(rand_test_results)

canape_results[, "endem_type", drop = FALSE]
```

This data set is very small, so it doesn't include all possible endemism types. In total, they include:

* `paleo`: paleoendemic
* `neo`: neoendemic
* `not significant` (what it says)
* `mixed`: mixture of both paleo and neo
* `super`: mixed and highly significant (*p* < 0.01)

For a more complete example, please [see the vignette](https://joelnitta.github.io/canaper/articles/canape.html)

## References

Mishler, B., Knerr, N., GonzÃ¡lez-Orozco, C. *et al*. Phylogenetic measures of biodiversity and neo- and paleo-endemism in Australian *Acacia*. *Nat Commun* 5, 4473 (2014). https://doi.org/10.1038/ncomms5473
